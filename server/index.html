<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>QuickGuard —فحص أمان الروابطة</title>
<meta name="description" content="تأكد من أمان أي رابط خلال ثوانٍ">
<meta name="theme-color" content="#0b0f14">
<meta property="og:title" content="QuickGuard — فحص أمان الروابط">
<meta property="og:description" content="تأكد من أمان أي رابط خلال ثوانٍ.">
<style>
  :root{
    --bg:#0b0f14; --panel:#11161d; --card:#141a22; --muted:#97a4b4; --text:#ecf0f6; --brand:#7aa2ff;
    --ok:#3bd1a7; --ok-ink:#0b5f4b; --warn:#ffd166; --warn-ink:#7a5a00; --fail:#ff7a7a; --fail-ink:#6e1b1b;
    --border:#1f2732; --chip:#1a2230; --shadow: 0 12px 32px rgba(0,0,0,.35); --radius:16px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f6f8fb; --panel:#ffffff; --card:#ffffff; --muted:#667085; --text:#0f172a; --brand:#3b82f6;
      --ok:#16c79a; --ok-ink:#064e3b; --warn:#fbbf24; --warn-ink:#7a5a00; --fail:#f87171; --fail-ink:#7f1d1d;
      --border:#e5e7eb; --chip:#f1f5f9; --shadow: 0 12px 28px rgba(2,6,23,.10);
    }
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:
      radial-gradient(1100px 700px at 85% -10%, rgba(59,130,246,.14),transparent 60%),
      radial-gradient(900px 600px at -5% 110%, rgba(16,185,129,.13),transparent 60%), var(--bg);
    color:var(--text);
    font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",Tahoma,Arial;
  }

  /* Top bar */
  .topbar{ position:sticky; top:0; z-index:20; backdrop-filter: blur(10px) saturate(1.1);
           background:color-mix(in oklab, var(--panel) 86%, transparent); border-bottom:1px solid var(--border);}
  .container{ max-width:1100px; margin-inline:auto; padding:16px;}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:38px;height:38px;border-radius:12px;display:grid;place-items:center;color:white;
        font-weight:800;background:linear-gradient(145deg,var(--brand),color-mix(in oklab,var(--brand) 75%,black)); box-shadow:var(--shadow)}
  .title{font-weight:900; letter-spacing:.2px}
  .subtitle{color:var(--muted); font-size:13px}

  /* Surface */
  .surface{ background:color-mix(in oklab,var(--panel) 78%, transparent); border:1px solid var(--border);
            border-radius:var(--radius); box-shadow:var(--shadow); margin-top:18px; overflow:hidden;}

  /* Form */
  .row{ display:flex; flex-wrap:wrap; gap:10px; padding:14px; border-bottom:1px solid var(--border); }
  .input{
    flex:1; min-width:260px; padding:12px 14px; border-radius:12px; border:1px solid var(--border);
    background:var(--card); color:var(--text); outline:0; transition:border .2s, box-shadow .2s;
  }
  .input:focus{ border-color:var(--brand); box-shadow:0 0 0 4px color-mix(in oklab,var(--brand) 20%, transparent); }
  .btn{
    padding:12px 16px; border-radius:12px; cursor:pointer; border:1px solid transparent; font-weight:800;
    transition:transform .08s ease, filter .2s ease, background .2s;
  }
  .btn:active{ transform: translateY(1px) }
  .btn-primary{ color:white; background:linear-gradient(145deg,var(--brand),color-mix(in oklab,var(--brand) 85%,black)); }
  .btn-ghost{ color:var(--text); background:var(--card); border:1px solid var(--border) }
  .btn:hover{ filter:brightness(1.05) }

  /* List */
  .list{ padding:10px 14px 18px }
  .empty{ color:var(--muted); text-align:center; padding:38px 0 }
  .card{
    display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; margin:10px 0;
    transition: transform .12s ease, border-color .2s ease;
  }
  .card:hover{ transform: translateY(-1px); border-color: color-mix(in oklab,var(--brand) 40%, var(--border)); }
  .url{ font-weight:800; word-break:break-all }
  .meta{ display:flex; gap:8px; flex-wrap:wrap; color:var(--muted); font-size:12.5px }
  .chip{ background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:6px 10px; }
  .badge{font-weight:900; padding:8px 12px; border-radius:999px; display:inline-flex; align-items:center; gap:6px; }
  .badge.pass{ background:color-mix(in oklab,var(--ok) 24%, var(--chip)); color:var(--ok-ink); }
  .badge.warn{ background:color-mix(in oklab,var(--warn) 28%, var(--chip)); color:var(--warn-ink); animation: pulse 1.2s ease-in-out 2; }
  .badge.fail{ background:color-mix(in oklab,var(--fail) 26%, var(--chip)); color:var(--fail-ink); }
  @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.03)} 100%{transform:scale(1)} }

  /* Toast */
  .toast{ position:fixed; inset-inline:0; top:14px; display:grid; place-items:center; z-index:50; pointer-events:none }
  .toast > div{ pointer-events:auto; background:var(--panel); border:1px solid var(--border); padding:10px 14px;
                border-radius:12px; box-shadow:var(--shadow); font-weight:800 }

  /* Confetti canvas */
  #confetti{ position:fixed; inset:0; pointer-events:none; z-index:40 }

  /* Footer */
  footer{ margin:24px auto; max-width:1100px; color:var(--muted); display:flex; justify-content:space-between; gap:12px; padding:0 16px }
</style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <div class="topbar">
    <div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:14px">
      <div class="brand">
        <div class="logo">QG</div>
        <div>
          <div class="title">QuickGuard</div>
          <div class="subtitle">تأكد من أمان أي رابط خلال ثوانٍ </div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div id="api-chip" class="chip">حالة الخدمة: <span id="api-state">…</span></div>
        <button id="aboutBtn" class="btn btn-ghost" style="padding:8px 12px">عن QuickGuard</button>
      </div>
    </div>
  </div>

  <div class="container surface">
    <div class="row">
      <input id="url" class="input" placeholder="ألصقي الرابط هنا… مثل: https://example.com" />
      <button id="scan" class="btn btn-primary">افحص الآن</button>
      <button id="refresh" class="btn btn-ghost">تحديث القائمة</button>
    </div>
    <div id="list" class="list">
      <div class="empty">ابدئي بإدخال رابط أعلاه ثم اضغطي «افحص الآن» — النتيجة ستظهر هنا مباشرة.</div>
    </div>
  </div>

  <!-- About modal -->
  <div id="aboutModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.35); backdrop-filter:blur(3px); z-index:60; align-items:center; justify-content:center">
    <div style="max-width:640px; width:calc(100% - 32px); background:var(--panel); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:18px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px">
        <h3 style="margin:0">عن QuickGuard</h3>
        <button id="closeAbout" class="btn btn-ghost">إغلاق</button>
      </div>
      <p style="color:var(--muted); line-height:1.9; margin-top:10px">
       QuickGuard أداة بسيطة وذكية تساعدك تفحص أي رابط وتتأكدي من أمانه فورًا.
تفحص أهم إعدادات الأمان مثل HSTS, CSP, X-Frame-Options وتكشف المشاكل المحتملة.
      </p>
      <ul style="margin:0; padding-inline-start:20px; line-height:1.9">
        <li>نتيجة فورية: <strong>آمن</strong> / <strong>ينصح بالمراجعة</strong> / <strong>غير آمن</strong> مع درجة رقمية</li>
        <li>تعمل على: الويب، إضافة كروم، واختصار iOS.</li>
        <li>تحترم خصوصيتك — لا نطلب تسجيل في نسخة الـMVP</li>
      </ul>
    </div>
  </div>

  <div id="toast" class="toast" style="display:none"><div></div></div>

  <footer>
    <div>© <span id="year"></span>  QuickGuard — فحص أمان الروابط</div>
    <div>تم تطويره بحب 💙 بواسطة رغد العتيبي</div>
  </footer>

<script>
  const API = "http://localhost:3000";
  const el = {
    url: document.getElementById("url"),
    scan: document.getElementById("scan"),
    refresh: document.getElementById("refresh"),
    list: document.getElementById("list"),
    toast: document.getElementById("toast"),
    apiChip: document.getElementById("api-chip"),
    apiState: document.getElementById("api-state"),
    confetti: document.getElementById("confetti"),
    aboutBtn: document.getElementById("aboutBtn"),
    aboutModal: document.getElementById("aboutModal"),
    closeAbout: document.getElementById("closeAbout"),
  };
  document.getElementById('year').textContent = new Date().getFullYear();

  /* ---------- About modal ---------- */
  el.aboutBtn.addEventListener("click", ()=> el.aboutModal.style.display = "flex");
  el.closeAbout.addEventListener("click", ()=> el.aboutModal.style.display = "none");
  el.aboutModal.addEventListener("click", (e)=>{ if(e.target === el.aboutModal) el.aboutModal.style.display = "none"; });

  /* ---------- Confetti (vanilla) ---------- */
  const ctx = el.confetti.getContext("2d");
  let particles = []; let rafId = null;
  function resizeCanvas(){ el.confetti.width = innerWidth; el.confetti.height = innerHeight; }
  addEventListener("resize", resizeCanvas); resizeCanvas();

  function makeConfettiBurst(x = innerWidth*0.6, y = innerHeight*0.22, count = 120){
    const colors = ["#7aa2ff","#3bd1a7","#ffd166","#a78bfa","#f472b6","#60a5fa"];
    for(let i=0;i<count;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = 4 + Math.random()*6;
      particles.push({
        x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 2,
        size: 6 + Math.random()*5, color: colors[Math.floor(Math.random()*colors.length)],
        life: 60 + Math.random()*40, rot: Math.random()*Math.PI, vr: (Math.random()-0.5)*0.2
      });
    }
    if(!rafId) animate();
  }
  function animate(){
    rafId = requestAnimationFrame(animate);
    ctx.clearRect(0,0,el.confetti.width,el.confetti.height);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vy += 0.12; p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life--;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
      ctx.fillStyle = p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); ctx.restore();
      if(p.life<=0 || p.y>el.confetti.height+40) particles.splice(i,1);
    }
    if(particles.length===0){ cancelAnimationFrame(rafId); rafId=null; }
  }

  /* ---------- Toast ---------- */
  function toast(msg, ms=1600){ el.toast.style.display="grid"; el.toast.firstElementChild.textContent = msg; setTimeout(()=>el.toast.style.display="none", ms); }

  /* ---------- Render ---------- */
  function render(items){
    if(!items || !items.length){
      el.list.innerHTML = `<div class="empty">لا توجد فحوصات بعد.</div>`;
      return;
    }
    el.list.innerHTML = items.map(s=>{
      const klass = s.verdict || "warn";
      const when = s.at ? new Date(s.at).toLocaleString() : "—";
      const ms = s.ms ? s.ms+"ms" : "—";
      const detail = (s.details||[]).slice(0,5).map(d=>`<span class="chip">${d}</span>`).join("");
      const label = klass==="pass"?"آمن ✅":klass==="warn"?"ينصح بالمراجعة ⚠️":"غير آمن ⛔";
      return `
        <div class="card">
          <div>
            <div class="url">🔗 ${s.url || "—"}</div>
            <div class="meta" style="margin-top:6px">
              <span class="chip">التوقيت: ${when}</span>
              <span class="chip">الاستجابة: ${ms}</span>
            </div>
            <div style="margin-top:8px">${detail || `<span class="chip">لا ملاحظات</span>`}</div>
          </div>
          <div>
            <div class="badge ${klass}" title="النتيجة">${label}</div>
            <div style="text-align:center; margin-top:8px; color:var(--muted); font-weight:900">${s.score ?? "—"}</div>
          </div>
        </div>
      `;
    }).join("");
  }

  async function load(){
    try{
      const r = await fetch(API + "/recent", {cache:"no-store"});
      if(!r.ok) throw new Error(r.status);
      const data = await r.json();
      render(data.scans||[]);
      el.apiState.textContent = "متصل";
      el.apiChip.style.outline = "2px solid rgba(34,197,94,.5)";
    }catch{
      el.apiState.textContent = "غير متصل";
      el.apiChip.style.outline = "2px solid rgba(239,68,68,.4)";
    }
  }

  function validUrl(u){ try{const x=new URL(u); return x.protocol==="http:"||x.protocol==="https:";}catch{return false;} }

  async function scan(url){
    if(!validUrl(url)) return toast("الرجاء إدخال رابط صالح");
    const original = el.scan.textContent;
    el.scan.textContent = "جارٍ الفحص…"; el.scan.disabled = true;
    try{
      const r = await fetch(API + "/scan",{
        method:"POST", headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ url })
      });
      const data = await r.json();
      await load();
      if(data.ok){
        if(data.verdict === "pass"){ makeConfettiBurst(); toast("تم — الرابط آمن 🎉"); }
        else if(data.verdict === "warn"){ toast("تم — ينصح بالمراجعة"); }
        else { toast("تم — الرابط غير آمن"); }
      }else{
        toast("فشل الفحص");
      }
    }catch{
      toast("تعذّر الاتصال بالخدمة — تحققي أن السيرفر يعمل");
    }finally{
      el.scan.textContent = original; el.scan.disabled = false;
    }
  }

  /* Events */
  el.refresh.onclick = load;
  el.scan.onclick = ()=> scan(el.url.value.trim());
  el.url.addEventListener("keydown",(e)=>{ if(e.key==="Enter") el.scan.click(); });

  /* Init */
  load();
</script>
</body>
</html>
